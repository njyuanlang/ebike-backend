/*!
 * 
 * Angle - Bootstrap Admin App + AngularJS
 * 
 * Author: @themicon_co
 * Website: http://themicon.co
 * License: http://support.wrapbootstrap.com/knowledge_base/topics/usage-licenses
 * 
 */
if("undefined"==typeof $)throw new Error("This application's JavaScript requires jQuery");var App=angular.module("angle",["ngRoute","ngAnimate","ngStorage","ngCookies","pascalprecht.translate","ui.bootstrap","ui.router","oc.lazyLoad","cfp.loadingBar","ngSanitize","ngResource","ebike-services","ui.utils"]);App.run(["$rootScope","$state","$stateParams","$window","$templateCache","User","RemoteStorage",function(e,t,r,o,n,a,i){e.$state=t,e.$stateParams=r,e.$storage=o.localStorage,e.app={name:"宝旭后台管理",description:"宝旭电动车后台管理系统",year:(new Date).getFullYear(),layout:{isFixed:!0,isCollapsed:!1,isBoxed:!1,isRTL:!1,horizontal:!1,isFloat:!1,asideHover:!1,theme:null},useFullLayout:!1,hiddenFooter:!1,viewAnimation:"ng-fadeInUp"},e.user={name:"John",job:"ng-developer",picture:"app/img/dummy.png"},a.isAuthenticated()&&(e.user=a.getCurrent(),e.user.$promise.then(function(){e.user.picture="app/img/dummy.png",i.getAvatar(e.user.id).success(function(t){e.user.picture=t})})),AMap.service("AMap.DistrictSearch",function(){var t=new AMap.DistrictSearch({level:"country",subdistrict:2});t.search("中国",function(t,r){e.provinces=r.districtList[0].districtList})})}]),App.config(["$stateProvider","$locationProvider","$urlRouterProvider","RouteHelpersProvider",function(e,t,r,o){"use strict";t.html5Mode(!1),r.otherwise("/page/login"),e.state("app",{url:"/app","abstract":!0,templateUrl:o.basepath("app.html"),controller:"AppController",resolve:o.resolveFor("modernizr","icons","toaster","ngTable","moment")}).state("app.dashboard",{url:"/dashboard",title:"Dashboard",controller:"DashboardController",templateUrl:o.basepath("dashboard.html"),resolve:o.resolveFor("flot-chart","flot-chart-plugins")}).state("app.mass",{url:"/mass",title:"Mass",controller:"MassController",templateUrl:o.basepath("mass.html")}).state("app.mass-compose",{url:"/mass/compose?touser",title:"Mass Compose",controller:"MassComposeController",templateUrl:o.basepath("mass-compose.html"),resolve:o.resolveFor("angularjs-region")}).state("app.messages",{url:"/messages",title:"Messages",controller:"MessagesController",templateUrl:o.basepath("messages.html")}).state("app.message-compose",{url:"/messages/compose?touser",title:"Message Compose",controller:"MessageComposeController",templateUrl:o.basepath("message-compose.html")}).state("app.merchants",{url:"/merchants",title:"Merchants",controller:"MerchantsController",templateUrl:o.basepath("merchants.html"),resolve:o.resolveFor("ngTableExport")}).state("app.clients",{url:"/clients",title:"Clients",controller:"ClientsController",templateUrl:o.basepath("clients.html"),resolve:o.resolveFor("ngTableExport")}).state("app.bikes",{url:"/bikes",title:"Bikes",controller:"BikesController",templateUrl:o.basepath("bikes.html")}).state("app.cruises",{url:"/cruises",title:"Cruises",controller:"CruisesController",templateUrl:o.basepath("cruises.html")}).state("app.tests",{url:"/tests",title:"Tests",controller:"TestsController",templateUrl:o.basepath("tests.html")}).state("app.manufacturers",{url:"/manufacturers",title:"Manufacturers",controller:"ManufacturersController",templateUrl:o.basepath("manufacturers.html")}).state("app.manufacturers-add",{url:"/manufacturers-add",title:"Manufacturers",templateUrl:o.basepath("manufacturers-add.html")}).state("app.brands",{url:"/brands",title:"Brands",controller:"BrandsController",templateUrl:o.basepath("brands.html")}).state("app.brands-add",{url:"/brands-add",title:"Brands Add",templateUrl:o.basepath("brands-add.html")}).state("app.brand",{url:"/brands/:brandId",title:"Brands detail",templateUrl:o.basepath("brand.html")}).state("app.devices",{url:"/devices",title:"Devices",controller:"DevicesController",templateUrl:o.basepath("devices.html")}).state("app.statistic-brand",{url:"/statistic-brand",title:"Statistic Brand",controller:"StatisticBrandController",templateUrl:o.basepath("statistic-brand.html"),resolve:o.resolveFor("flot-chart","flot-chart-plugins")}).state("app.statistic-region",{url:"/statistic-region",title:"Statistic Region",controller:"StatisticRegionController",templateUrl:o.basepath("statistic-region.html"),resolve:o.resolveFor("flot-chart","flot-chart-plugins")}).state("app.statistic-fault",{url:"/statistic-fault",title:"Statistic Fault",controller:"StatisticFaultController",templateUrl:o.basepath("statistic-fault.html"),resolve:o.resolveFor("flot-chart","flot-chart-plugins","angularjs-region")}).state("app.accounts",{url:"/accounts",title:"Accounts",controller:"AccountsController",templateUrl:o.basepath("accounts.html")}).state("app.accounts-add",{url:"/accounts-add",title:"Accounts Add",templateUrl:o.basepath("accounts-add.html")}).state("app.account",{url:"/accounts/:accountId",title:"Account",templateUrl:o.basepath("account.html")}).state("page",{url:"/page",templateUrl:"app/pages/page.html",resolve:o.resolveFor("modernizr","icons","ebike-services"),controller:["$rootScope",function(e){e.app.layout.isBoxed=!1}]}).state("page.login",{url:"/login",title:"Login",templateUrl:"app/pages/login.html"}).state("page.recover",{url:"/recover",title:"Recover",templateUrl:"app/pages/recover.html"})}]).config(["$ocLazyLoadProvider","APP_REQUIRES",function(e,t){"use strict";e.config({debug:!1,events:!0,modules:t.modules})}]).config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function(e,t,r,o){"use strict";App.controller=e.register,App.directive=t.directive,App.filter=r.register,App.factory=o.factory,App.service=o.service,App.constant=o.constant,App.value=o.value}]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"app/i18n/",suffix:".json"}),e.preferredLanguage("zh_CN"),e.useLocalStorage(),e.usePostCompiling(!0)}]).config(["cfpLoadingBarProvider",function(e){e.includeBar=!0,e.includeSpinner=!1,e.latencyThreshold=500,e.parentSelector=".wrapper > section"}]).config(["$tooltipProvider",function(e){e.options({appendToBody:!0})}]).constant("urlBase","https://api.baoxu360.com/api").config(["LoopBackResourceProvider","urlBase",function(e,t){e.setUrlBase(t)}]).config(["$httpProvider",function(e){e.interceptors.push(["$q","$location","LoopBackAuth",function(e,t,r){return{responseError:function(o){return 401==o.status&&(r.clearUser(),r.clearStorage(),t.path("/page/login")),e.reject(o)}}}])}]),App.constant("APP_COLORS",{primary:"#5d9cec",success:"#27c24c",info:"#23b7e5",warning:"#ff902b",danger:"#f05050",inverse:"#131e26",green:"#37bc9b",pink:"#f532e5",purple:"#7266ba",dark:"#3a3f51",yellow:"#fad732","gray-darker":"#232735","gray-dark":"#3a3f51",gray:"#dde6e9","gray-light":"#e4eaec","gray-lighter":"#edf1f2"}).constant("APP_MEDIAQUERY",{desktopLG:1200,desktop:992,tablet:768,mobile:480}).constant("APP_REQUIRES",{scripts:{"flot-chart":["vendor/flot/jquery.flot.js"],"flot-chart-plugins":["vendor/flot.tooltip/js/jquery.flot.tooltip.min.js","vendor/flot/jquery.flot.resize.js","vendor/flot/jquery.flot.pie.js","vendor/flot/jquery.flot.time.js","vendor/flot/jquery.flot.categories.js","vendor/flot/jquery.flot.stack.js","vendor/flot-spline/js/jquery.flot.spline.min.js"],moment:["vendor/moment/min/moment-with-locales.min.js"],modernizr:["vendor/modernizr/modernizr.js"],icons:["vendor/fontawesome/css/font-awesome.min.css","vendor/simple-line-icons/css/simple-line-icons.css"]},modules:[{name:"toaster",files:["vendor/angularjs-toaster/toaster.js","vendor/angularjs-toaster/toaster.css"]},{name:"ngTable",files:["vendor/ng-table/dist/ng-table.min.js","vendor/ng-table/dist/ng-table.min.css"]},{name:"ngTableExport",files:["vendor/ng-table-export/ng-table-export.js"]},{name:"angularjs-region",files:["vendor/angularjs-region/angularjs-region.js"]},{name:"ebike-services",files:["vendor/ebike-services/ebike-lbservices.js","vendor/ebike-services/ebike-services.js"]}]}),App.controller("LoginFormController",["$scope","$state","User","$rootScope",function(e,t,r,o){e.account={realm:"administrator",rememberMe:!0},e.authMsg="",e.login=function(){e.authMsg="",e.loginForm.$valid?r.login(e.account,function(e){o.user=e.user,o.user.avatar=e.user.avatar||"app/img/dummy.png",t.go("app.dashboard")},function(t){e.authMsg=t.data.error.message}):(e.loginForm.account_email.$dirty=!0,e.loginForm.account_password.$dirty=!0)}}]),App.controller("ResetPasswordFormController",["$scope","$state","User",function(e,t,r){e.recover={},e.reset=function(){t.go("page.login")}}]),App.controller("AccountsController",["$scope","User","ngTableParams",function(e,t,r){e.filter={text:""},e.tableParams=new r({count:10,filter:e.filter.text},{getData:function(r,o){var n={order:"created DESC"};n.limit=o.count(),n.skip=(o.page()-1)*n.limit,n.where={realm:"administrator"},""!=e.filter.text&&(n.where.name={like:e.filter.text}),t.count({where:n.where},function(o){e.tableParams.total(o.count),t.find({filter:n},r.resolve)})}})}]),App.controller("AccountsAddController",["$scope","User","$state","toaster",function(e,t,r,o){e.entity={realm:"administrator"},e.submitted=!1,e.validateInput=function(t,r){var o=e.formValidate[t];return(o.$dirty||e.submitted)&&o.$error[r]},e.submitForm=function(){return e.submitted=!0,e.formValidate.$valid?(e.entity.username=e.entity.email,void t.create(e.entity,function(e){o.pop("success","新增成功","已经添加帐号 "+e.name),setTimeout(function(){r.go("app.accounts")},2e3)},function(e){o.pop("error","新增错误",e.data.error.message)})):!1}}]),App.controller("AccountController",["$scope","User","$state","toaster",function(e,t,r,o){e.entity=t.findById({id:r.params.accountId}),e.submitted=!1,e.validateInput=function(t,r){var o=e.formValidate[t];return(o.$dirty||e.submitted)&&o.$error[r]},e.submitForm=function(){return e.submitted=!0,e.formValidate.$valid?void t.upsert(e.entity,function(e){o.pop("success","更新成功","已经更新帐号 "+e.name),setTimeout(function(){r.go("app.accounts")},2e3)},function(e){o.pop("error","更新错误",e.data.error.message)}):!1}}]),App.controller("BikesController",["$scope","Bike","ngTableParams",function(e,t,r){e.filter={text:""},e.tableParams=new r({count:10,filter:e.filter.text},{getData:function(r,o){var n={order:"created DESC"};n.limit=o.count(),n.skip=(o.page()-1)*n.limit,""!=e.filter.text&&(n.where={serialNumber:{like:e.filter.text}}),t.count({where:n.where},function(o){e.tableParams.total(o.count),t.find({filter:n},r.resolve)})}})}]),App.controller("BrandsController",["$scope","Brand","ngTableParams",function(e,t,r){e.filter={text:""},e.tableParams=new r({count:10,filter:e.filter.text},{getData:function(r,o){var n={order:"created DESC",include:"manufacturer"};n.limit=o.count(),n.skip=(o.page()-1)*n.limit,""!=e.filter.text&&(n.where={name:{like:e.filter.text}}),t.count({where:n.where},function(o){e.tableParams.total(o.count),t.find({filter:n},r.resolve)})}})}]),App.controller("BrandsAddController",["$scope","Brand","$state","toaster","Manufacturer",function(e,t,r,o,n){e.entity={},e.manufacturers=n.query(),e.submitted=!1,e.validateInput=function(t,r){var o=e.formValidate[t];return(o.$dirty||e.submitted)&&o.$error[r]},e.submitForm=function(){return e.submitted=!0,e.formValidate.$valid?void t.create(e.entity,function(e){o.pop("success","新增成功","已经添加品牌 "+e.name),setTimeout(function(){r.go("app.brands")},2e3)},function(e){o.pop("error","新增错误",e.data.error.message)}):!1}}]),App.controller("BrandController",["$scope","Brand","$state","toaster","Manufacturer","ngTableParams",function(e,t,r,o,n,a){e.manufacturers=n.query(),e.entity=t.findById({id:r.params.brandId}),e.model="",e.submitted=!1,e.validateInput=function(t,r){var o=e.formValidate[t];return(o.$dirty||e.submitted)&&o.$error[r]};var i=function(e){setTimeout(function(){r.go("app.brands")},e||2e3)};e.submitForm=function(){return e.submitted=!0,e.formValidate.$valid?void t.upsert(e.entity,function(e){o.pop("success","更新成功","已经更新品牌 "+e.name),i()},function(e){o.pop("error","更新错误",e.data.error.message)}):!1},e.addNewModel=function(){""!==e.model&&(e.entity.models||(e.entity.models=[]),e.entity.models.indexOf(e.model)>=0||e.entity.models.push(e.model))},e.remove=function(){t.prototype$updateAttributes({id:e.entity.id},{status:"removed"}).$promise.then(function(e){o.pop("success","删除成功","已经删除品牌 "+e.name),i()},function(e){o.pop("error","删除失败","未成功删除品牌")})}}]),App.controller("ClientsController",["$scope","$state","User","ngTableParams","$rootScope","RemoteStorage","$http","LoopBackAuth","$document","$timeout","urlBase",function(e,t,r,o,n,a,i,s,l,c,u){e.filter={text:""},e.tableParams=new o({count:10,filter:e.filter.text},{getData:function(t,o){var n={order:"created DESC"};n.limit=o.count(),n.skip=(o.page()-1)*n.limit,n.where={realm:"client"},""!=e.filter.text&&(n.where.username={regex:e.filter.text}),r.count({where:n.where},function(o){e.tableParams.total(o.count),r.find({filter:n},function(e){e.forEach(function(e){e.avatar="app/img/dummy.png",a.getAvatar(e.id).success(function(t){e.avatar=t})}),t.resolve(e)})})}}),e.reply=function(e){n.messageDraft={touser:e},t.go("app.message-compose")},e.generate=function(){i.get(u+"/users/export?access_token="+s.accessTokenId,{responseType:"arraybuffer"}).success(function(t,r,o,n){var a=new Blob([t],{type:"text/csv;charset=GBK;"}),i=angular.element('<div data-tap-disabled="true"><a></a></div>'),s=angular.element(i.children()[0]);s.attr("href",window.URL.createObjectURL(a)),s.attr("download",e.user.email+Date.now()+".csv"),s.attr("target","_blank"),l.find("body").append(i),c(function(){s[0].click(),s.remove()},null)})}}]),App.controller("CruisesController",["$scope","Cruise","ngTableParams",function(e,t,r){e.filter={text:""},e.tableParams=new r({count:10,filter:e.filter.text},{getData:function(r,o){var n={order:"created DESC",include:"bike"};n.limit=o.count(),n.skip=(o.page()-1)*n.limit,""!=e.filter.text&&(n.where={serialNumber:{like:e.filter.text}}),t.count({where:n.where},function(o){e.tableParams.total(o.count),t.find({filter:n},r.resolve)})}})}]),App.controller("DashboardController",["$scope","User","Bike","ngTableParams",function(e,t,r,o){e.statistic={user:{added:0,total:0},bike:{added:0,total:0}},e.stat=function(){var o=15,n=moment().endOf("day"),a=moment().startOf("day"),i=moment().subtract(o,"days").startOf("day");t.count({where:{created:{gte:a},realm:"client"}},function(t){e.statistic.user.added=t.count}),t.count({where:{realm:"client"}},function(t){e.statistic.user.total=t.count}),r.count({where:{created:{gte:a}}},function(t){e.statistic.bike.added=t.count}),r.count({},function(t){e.statistic.bike.total=t.count});var s=null,l=null;t.stat({filter:{where:{created:{between:[i,n]},realm:"client"}}},function(t){s={label:"新增用户",color:"#768294",data:[]};for(var r=1,a=0;o>=r;r++){for(var i=moment(n).subtract(o-r,"days"),c=null;a<t.length;){if(c=moment(t[a]._id.year+"-"+t[a]._id.month+"-"+t[a]._id.dayOfMonth,"YYYY-MM-DD"),i.isBefore(c,"day")){c=null;break}if(i.isSame(c,"day"))break;c=null,a++}s.data.push([i.format("MM/DD"),c?t[a].count:0])}s&&l&&(e.chartData=[s,l])}),r.stat({filter:{where:{created:{between:[i,n]}}}},function(t){l={label:"新增车辆",color:"#1f92fe",data:[]};for(var r=1,a=0;o>=r;r++){for(var i=moment(n).subtract(o-r,"days"),c=null;a<t.length;){if(c=moment(t[a]._id.year+"-"+t[a]._id.month+"-"+t[a]._id.dayOfMonth,"YYYY-MM-DD"),i.isBefore(c,"day")){c=null;break}if(i.isSame(c,"day"))break;c=null,a++}l.data.push([i.format("MM/DD"),c?t[a].count:0])}s&&l&&(e.chartData=[s,l])})},e.stat(),e.lineOptions={series:{lines:{show:!0,fill:.01},points:{show:!0,radius:4}},grid:{borderColor:"#eee",borderWidth:1,hoverable:!0,backgroundColor:"#fcfcfc"},tooltip:!0,tooltipOpts:{content:function(e,t,r){return t+" : "+r}},xaxis:{tickColor:"#eee",mode:"categories"},yaxis:{position:e.app.layout.isRTL?"right":"left",tickColor:"#eee"},shadowSize:0}}]),App.controller("DevicesController",["$scope","Device","ngTableParams",function(e,t,r){e.filter={text:""},e.tableParams=new r({count:10,filter:e.filter.text},{getData:function(r,o){var n={order:"created DESC"};n.limit=o.count(),n.skip=(o.page()-1)*n.limit,""!=e.filter.text&&(n.where={serialNumber:{like:e.filter.text}}),t.count({where:n.where},function(o){e.tableParams.total(o.count),t.find({filter:n},r.resolve)})}})}]),App.controller("AppController",["$rootScope","$scope","$state","$translate","$window","$localStorage","$timeout","toggleStateService","colors","browser","cfpLoadingBar","User",function(e,t,r,o,n,a,i,s,l,c,u,p){"use strict";e.app.layout.horizontal="app-h"==e.$stateParams.layout;var d;e.$on("$stateChangeStart",function(e,t,r,o,n){$(".wrapper > section").length&&(d=i(function(){u.start()},0))}),e.$on("$stateChangeSuccess",function(e,t,r,o,n){e.targetScope.$watch("$viewContentLoaded",function(){i.cancel(d),u.complete()})}),e.$on("$stateNotFound",function(e,t,r,o){console.log(t.to),console.log(t.toParams),console.log(t.options)}),e.$on("$stateChangeError",function(e,t,r,o,n,a){console.log(a)}),e.$on("$stateChangeSuccess",function(t,o,a,i,s){n.scrollTo(0,0),e.currTitle=r.current.title}),e.currTitle=r.current.title,e.pageTitle=function(){var t=e.app.name+" - "+(e.currTitle||e.app.description);return document.title=t,t},e.$watch("app.layout.isCollapsed",function(t,r){t===!1&&e.$broadcast("closeSidebarMenu")}),angular.isDefined(a.layout)?t.app.layout=a.layout:a.layout=t.app.layout,e.$watch("app.layout",function(){a.layout=t.app.layout},!0),t.colorByName=l.byName,t.logout=function(){p.logout(),r.go("page.login")},t.language={listIsOpen:!1,available:{zh_CN:"中文简体",en:"English",es_AR:"Español"},init:function(){var e=o.proposedLanguage()||o.use(),r=o.preferredLanguage();t.language.selected=t.language.available[e||r]},set:function(e,r){o.use(e),t.language.selected=t.language.available[e],t.language.listIsOpen=!t.language.listIsOpen}},t.language.init(),s.restoreState($(document.body)),e.cancel=function(e){e.stopPropagation()}}]),App.controller("ManufacturersController",["$scope","Manufacturer","ngTableParams",function(e,t,r){e.filter={text:""},e.tableParams=new r({count:10,filter:e.filter.text},{getData:function(r,o){var n={order:"created DESC"};n.limit=o.count(),n.skip=(o.page()-1)*n.limit,""!=e.filter.text&&(n.where={name:{like:e.filter.text}}),t.count({where:n.where},function(o){e.tableParams.total(o.count),t.find({filter:n},r.resolve)})}})}]),App.controller("ManufacturersAddController",["$scope","$state","Manufacturer","toaster",function(e,t,r,o){e.entity={},e.submitted=!1,e.validateInput=function(t,r){var o=e.formValidate[t];return(o.$dirty||e.submitted)&&o.$error[r]},e.submitForm=function(){return e.submitted=!0,e.formValidate.$valid?void r.create(e.entity,function(e){o.pop("success","新增制造商成功","已经添加制造商 "+e.name),setTimeout(function(){t.go("app.manufacturers")},2e3)},function(e){o.pop("error","新增制造商错误",e.data.error.message),console.log(e)}):!1}}]),App.controller("MassController",["$scope","$rootScope","$state","Mass","ngTableParams",function(e,t,r,o,n){e.filter={text:""},e.tableParams=new n({count:10,filter:e.filter.text},{getData:function(t,r){var n={include:["FromUser"]};n.limit=r.count(),n.skip=(r.page()-1)*n.limit,n.where={},""!=e.filter.text&&(n.where.Content={regex:e.filter.text}),o.count({where:n.where},function(r){e.tableParams.total(r.count),o.find({filter:n},function(e){t.resolve(e)})})}}),e["delete"]=function(t){o.deleteById({id:t.id},function(){e.tableParams.reload()})}}]),App.controller("MassComposeController",["$scope","$state","Mass","toaster",function(e,t,r,o){AMap.service("AMap.DistrictSearch",function(){var t=new AMap.DistrictSearch({level:"country",subdistrict:2});t.search("中国",function(t,r){e.provinces=r.districtList[0].districtList,e.$apply()})}),e.region={province:"",city:""},e.submitForm=function(){var n={where:{},Content:e.content};if(e.region&&(e.region.province&&""!==e.region.province&&(n.where.region={province:e.region.province.name}),e.region.city&&""!==e.region.city)){var a=e.region.city.name;a.match(/市辖区$/m)?n.where.region.city=a.substr(0,a.length-3):n.where.region.city=a}r.create(n,function(e){o.pop("success","提交成功","已经向服务器提交了发送请求！"),setTimeout(function(){t.go("app.mass")},2e3)},function(e){o.pop("error","发送错误",res.data.error.mass)})}}]),App.controller("MerchantsController",["$scope","$rootScope","$state","$compile",function(e,t,r,o){function n(){i&&(Object.assign(s,e.query),i.setOptions(s),i.searchByDistrict("全国",function(t,r){"complete"===t?(e.pois=r.datas,console.log(e.pois),e.$apply()):e.pois=[]}))}var a=new AMap.Map("container",{resizeEnable:!0,zoom:12});e.map=a;var i,s={map:a,keywords:"",panel:"panel",pageSize:10,autoFitView:!0},l="55ffc0afe4b0ead8fa4df390";a.getCenter();e.query={keywords:""},e.pois=[],AMap.plugin(["AMap.CloudDataLayer","AMap.ToolBar"],function(){var e=new AMap.ToolBar;a.addControl(e)}),e.refresh=n,AMap.service(["AMap.CloudDataSearch"],function(){i=new AMap.CloudDataSearch(l,s),n()}),e.navigate=function(){e.infoWindow&&e.infoWindow.close(),e.MWalk.search(e.myPosition,e.clouddata._location)}}]).directive("infowindow",function(){"use strict";function e(e,t,r){e.infoWindow=new AMap.InfoWindow({content:t[0],closeWhenClickMap:!0,size:new AMap.Size(240,0),autoMove:!0,offset:new AMap.Pixel(0,-25)})}return{templateUrl:"merchant-popover.html",scope:!1,link:e}}),App.controller("MessagesController",["$scope","$rootScope","$state","Message","ngTableParams","RemoteStorage",function(e,t,r,o,n,a){e.filter={text:""},e.tableParams=new n({count:10,filter:e.filter.text},{getData:function(t,r){var n={include:["FromUser"]};n.limit=r.count(),n.skip=(r.page()-1)*n.limit,n.where={ToUserName:e.user.id},""!=e.filter.text&&(n.where.Content={regex:e.filter.text}),o.count({where:n.where},function(r){e.tableParams.total(r.count),o.find({filter:n},function(e){e.forEach(function(e){e.FromUser.avatar="app/img/dummy.png",a.getAvatar(e.FromUserName).success(function(t){e.FromUser.avatar=t})}),t.resolve(e)})})}}),e.reply=function(e){t.messageDraft={touser:e},r.go("app.message-compose")}}]),App.controller("MessageComposeController",["$scope","$state","Message","ngTableParams","toaster",function(e,t,r,o,n){e.submitForm=function(o){r.create({ToUserName:e.messageDraft.touser.id,Content:e.content},function(r){n.pop("success","发送成功","已经向"+e.messageDraft.touser.name+"发送了消息！"),setTimeout(function(){t.go("app.messages")},2e3)},function(e){n.pop("error","发送错误",res.data.error.message)})},e.tableParams=new o({count:10},{counts:[],getData:function(t,o){var n={include:["FromUser"]};n.limit=10,n.skip=0,n.where={and:[{or:[{ToUserName:e.messageDraft.touser.id},{FromUserName:e.messageDraft.touser.id}]}]},r.find({filter:n},function(r){r.forEach(function(t){t.avatar=t.FromUserName==e.user.id?e.user.picture:e.messageDraft.touser.avatar}),t.resolve(r)})}}),e["delete"]=function(t){r.deleteById({id:t.id},function(){e.tableParams.reload()})}}]),App.controller("SidebarController",["$rootScope","$scope","$state","$http","$timeout","Utils",function(e,t,r,o,n,a){function i(e){e+="";for(var t in l)(0>e||e.indexOf(t)<0)&&(l[t]=!0)}function s(e){return"string"==typeof e&&!(e.indexOf("-")<0)}var l=[];e.$watch("app.layout.asideHover",function(e,t){t===!1&&e===!0&&i(-1)});var c=function(e){if(e){if(e.sref&&"#"!=e.sref)return r.is(e.sref)||r.includes(e.sref);var t=!1;return angular.forEach(e.submenu,function(e,r){c(e)&&(t=!0)}),t}};t.getMenuItemPropClasses=function(e){return(e.heading?"nav-heading":"")+(c(e)?" active":"")},t.loadSidebarMenu=function(){var e="server/sidebar-menu.json",r=e+"?v="+(new Date).getTime();o.get(r).success(function(e){t.menuItems=e}).error(function(e,t,r,o){alert("Failure loading menu")})},t.loadSidebarMenu(),t.addCollapse=function(t,r){l[t]=e.app.layout.asideHover?!0:!c(r)},t.isCollapse=function(e){return l[e]},t.toggleCollapse=function(r,o){return a.isSidebarCollapsed()||e.app.layout.asideHover?!0:(angular.isDefined(l[r])?t.lastEventFromChild||(l[r]=!l[r],i(r)):o&&i(-1),t.lastEventFromChild=s(r),!0)}}]),App.controller("StatisticBrandController",["$scope","Bike","ngTableParams",function(e,t,r){e.barOptions={series:{bars:{align:"center",lineWidth:0,show:!0,barWidth:.6,fill:.9}},grid:{borderColor:"#eee",borderWidth:1,hoverable:!0,clickable:!0,backgroundColor:"#fcfcfc"},tooltip:!0,tooltipOpts:{content:function(e,t,r){return t+" : "+r}},xaxis:{tickColor:"#fcfcfc",mode:"categories"},yaxis:{position:e.app.layout.isRTL?"right":"left",tickColor:"#eee"},shadowSize:0};var o={};e.tableParams=new r({count:10},{getData:function(r,n){o.beginDate=moment(e.beginDate).valueOf(),o.endDate=moment(e.endDate).valueOf(),e.region.city?o.where["owner.region"]={province:e.region.province.name,city:e.region.city.name}:e.region.province&&(o.where={"owner.region.province":e.region.province.name}),o.limit=n.count(),o.skip=(n.page()-1)*o.limit,t.statistic({filter:o},function(t){e.total=t.total,e.aggregateTotal=t.aggregateTotal,r.resolve(t.data),e.barData=[{label:"新增车辆",color:"#9cd159",data:[]}],t.data.forEach(function(t){e.barData[0].data.push([t._id||"其他",t.count])})})}}),e.goRoot=function(){o={where:{},groupBy:"brand.name"},e.tableParams.reload()},e.goRoot(),e.goSubCatagory=function(t,r,n){n&&(o.where={"brand.name":e.tableParams.data[n.dataIndex]._id},o.groupBy="model",e.tableParams.reload())},e.endDate=moment().format("YYYY-MM-DD"),e.beginDate=moment().subtract(30,"days").format("YYYY-MM-DD"),e.openeds=[!1,!1],e.open=function(t,r){t.preventDefault(),t.stopPropagation(),e.openeds[r]=!0,e.openeds[++r%2]=!1},e.region={}}]),App.controller("StatisticRegionController",["$scope","Bike","ngTableParams","Brand",function(e,t,r,o){e.barOptions={series:{bars:{align:"center",lineWidth:0,show:!0,barWidth:.6,fill:.9}},grid:{borderColor:"#eee",borderWidth:1,hoverable:!0,clickable:!0,backgroundColor:"#fcfcfc"},tooltip:!0,tooltipOpts:{content:function(e,t,r){return t+" : "+r}},xaxis:{tickColor:"#fcfcfc",mode:"categories"},yaxis:{position:e.app.layout.isRTL?"right":"left",tickColor:"#eee"},shadowSize:0};var n={};e.tableParams=new r({count:10},{getData:function(r,o){n.beginDate=moment(e.beginDate).valueOf(),n.endDate=moment(e.endDate).valueOf(),e.model?n.where.model=e.model:e.brand&&(n.where["brand.id"]=e.brand.id),n.limit=o.count(),n.skip=(o.page()-1)*n.limit,t.statistic({filter:n},function(t){e.total=t.total,e.aggregateTotal=t.aggregateTotal,r.resolve(t.data),e.barData=[{label:"新增车辆",color:"#9cd159",data:[]}],t.data.forEach(function(t){e.barData[0].data.push([t._id||"其他",t.count])})})}}),e.goRoot=function(){n={where:{},groupBy:"owner.region.province"},e.tableParams.reload()},e.goRoot(),e.goSubCatagory=function(t,r,o){o&&(n.where={"owner.region.province":e.tableParams.data[o.dataIndex]._id},n.groupBy="owner.region.city",e.tableParams.reload())},e.endDate=moment().format("YYYY-MM-DD"),e.beginDate=moment().subtract(30,"days").format("YYYY-MM-DD"),e.openeds=[!1,!1],e.open=function(t,r){t.preventDefault(),t.stopPropagation(),e.openeds[r]=!0,e.openeds[++r%2]=!1},e.brands=o.find({filter:{limit:99999}})}]),App.controller("StatisticFaultController",["$scope","Test","ngTableParams","Brand","ChinaRegion",function(e,t,r,o,n){e.barStackedOptions={series:{stack:!0,bars:{align:"center",lineWidth:0,show:!0,barWidth:.6,fill:.9}},grid:{borderColor:"#eee",borderWidth:1,hoverable:!0,backgroundColor:"#fcfcfc"},tooltip:!0,tooltipOpts:{content:function(e,t,r){return t+" : "+r}},xaxis:{tickColor:"#fcfcfc",mode:"categories",categories:["30","60","90","120","150","180","210","240","270","300","330","360"]},yaxis:{tickColor:"#eee"},shadowSize:0},e.tableParams=new r({count:10},{getData:function(r,o){var n=null;(e.brand&&"全部品牌"!==e.brand.name||e.province&&"全部地区"!==e.province.name)&&(n={where:{}},"全部品牌"!==e.brand.name&&(n.where["bike.brand.name"]=e.brand.name),"全部地区"!==e.province.name&&(n.where["bike.owner.region.province"]=e.province.name)),t.stat({filter:n},function(t){r.resolve(t),e.barStackedData=[{label:"刹车",color:"#9cd159",data:[]},{label:"电机",color:"#4a8ef1",data:[]},{label:"控制器",color:"#f0693a",data:[]},{label:"转把",color:"#51bff2",data:[]}],t.forEach(function(t){("all"===e.type||"brake"===e.type)&&e.barStackedData[0].data.push([t._id,t.brake]),("all"===e.type||"motor"===e.type)&&e.barStackedData[1].data.push([t._id,t.motor]),("all"===e.type||"controller"===e.type)&&e.barStackedData[2].data.push([t._id,t.controller]),("all"===e.type||"steering"===e.type)&&e.barStackedData[3].data.push([t._id,t.steering])})})}}),o.find({filter:{fields:{name:!0}}},function(t){e.brands=[{name:"全部品牌"}].concat(t),e.brand=e.brands[0]}),e.provinces=[{name:"全部地区"}].concat(n.provinces),e.province=e.provinces[0],e.type="all",e.filter={where:{}}}]),App.controller("TestsController",["$scope","Test","ngTableParams",function(e,t,r){e.filter={text:""},e.tableParams=new r({count:10,filter:e.filter.text},{getData:function(r,o){var n={order:"created DESC"};n.limit=o.count(),n.skip=(o.page()-1)*n.limit,""!=e.filter.text&&(n.where={"bike.serialNumber":{like:e.filter.text}}),t.count({where:n.where},function(o){e.tableParams.total(o.count),t.find({filter:n},r.resolve)})}})}]),App.directive("flot",["$http","$timeout",function(e,t){"use strict";function r(r,o,n){function a(){var e;if(r.dataset&&r.options)return e=$.plot(p,r.dataset,r.options),r.$emit("plotReady",e),r.callback&&r.callback(e,r),e}function i(e){return u?(u.setData(e),u.setupGrid(),u.draw()):(u=a(),s(r.series),u)}function s(e){function t(e){return function(t,o){r[o]&&r[o][e]&&(r[o][e].show=t)}}if(u&&e){var r=u.getData();for(var o in e)angular.forEach(e[o],t(o));u.setData(r),u.draw()}}function l(o){o&&e.get(o).success(function(e){t(function(){r.dataset=e})}).error(function(){$.error("Flot chart: Bad request.")})}var c,u,p,d,f=220;u=null,d=n.width||"100%",c=n.height||f,p=$(o.children()[0]),p.css({width:d,height:c}),p.on("plotclick",function(e,o,n){t(function(){r.onPlotClick({event:e,pos:o,item:n})})}),r.$watchCollection("dataset",i,!0),r.$watch("series",s,!0),r.$watch("src",l)}return{restrict:"EA",template:"<div></div>",scope:{dataset:"=?",options:"=",series:"=",callback:"=",onPlotClick:"&",src:"="},link:r}}]),App.directive("searchOpen",["navSearch",function(e){"use strict";return{restrict:"A",controller:["$scope","$element",function(t,r){r.on("click",function(e){e.stopPropagation()}).on("click",e.toggle)}]}}]).directive("searchDismiss",["navSearch",function(e){"use strict";var t='.navbar-form input[type="text"]';return{restrict:"A",controller:["$scope","$element",function(r,o){$(t).on("click",function(e){e.stopPropagation()}).on("keyup",function(t){27==t.keyCode&&e.dismiss()}),$(document).on("click",e.dismiss),o.on("click",function(e){e.stopPropagation()}).on("click",e.dismiss)}]}}]),App.directive("now",["dateFilter","$interval",function(e,t){return{restrict:"E",link:function(r,o,n){function a(){var t=e(new Date,i);o.text(t)}var i=n.format;a(),t(a,1e3)}}}]),App.directive("sidebar",["$rootScope","$window","Utils",function(e,t,r){function o(){var e=$("<div/>",{"class":"dropdown-backdrop"});e.insertAfter(".aside-inner").on("click mouseenter",function(){i()})}function n(e){e.siblings("li").removeClass("open").end().toggleClass("open")}function a(e){i();var t=e.children("ul");if(!t.length)return $();if(e.hasClass("open"))return n(e),$();var r=$(".aside"),o=$(".aside-inner"),a=parseInt(o.css("padding-top"),0)+parseInt(r.css("padding-top"),0),u=t.clone().appendTo(r);n(e);var p=e.position().top+a-l.scrollTop(),d=c.height();return u.addClass("nav-floating").css({position:s.app.layout.isFixed?"fixed":"absolute",top:p,bottom:u.outerHeight(!0)+p>d?0:"auto"}),u.on("mouseleave",function(){n(e),u.remove()}),u}function i(){$(".dropdown-backdrop").remove(),$(".sidebar-subnav.nav-floating").remove(),$(".sidebar li.open").removeClass("open")}var s,l,c=$(t),u=$("body"),p=e.$state.current.name;return{restrict:"EA",template:'<nav class="sidebar" ng-transclude></nav>',transclude:!0,replace:!0,link:function(t,n,d){s=t,l=n;var f=r.isTouch()?"click":"mouseenter",m=$();l.on(f,".nav > li",function(){(r.isSidebarCollapsed()||e.app.layout.asideHover)&&(m.trigger("mouseleave"),m=a($(this)),o())}),t.$on("closeSidebarMenu",function(){i()}),c.on("resize",function(){r.isMobile()||u.removeClass("aside-toggled")}),e.$on("$stateChangeStart",function(t,r,o,n,a){p=r.name,$("body.aside-toggled").removeClass("aside-toggled"),e.$broadcast("closeSidebarMenu")})}
}}]),App.directive("toggleState",["toggleStateService",function(e){"use strict";return{restrict:"A",link:function(t,r,o){var n=$("body");$(r).on("click",function(t){t.preventDefault();var r=o.toggleState;r&&(n.hasClass(r)?(n.removeClass(r),o.noPersist||e.removeState(r)):(n.addClass(r),o.noPersist||e.addState(r)))})}}}]),App.service("browser",function(){"use strict";var e,t,r=function(e){e=e.toLowerCase();var t=/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],r=/(ipad)/.exec(e)||/(iphone)/.exec(e)||/(android)/.exec(e)||/(windows phone)/.exec(e)||/(win)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/i.exec(e)||[];return{browser:t[3]||t[1]||"",version:t[2]||"0",platform:r[0]||""}};if(e=r(window.navigator.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version,t.versionNumber=parseInt(e.version)),e.platform&&(t[e.platform]=!0),(t.android||t.ipad||t.iphone||t["windows phone"])&&(t.mobile=!0),(t.cros||t.mac||t.linux||t.win)&&(t.desktop=!0),(t.chrome||t.opr||t.safari)&&(t.webkit=!0),t.rv){var o="msie";e.browser=o,t[o]=!0}if(t.opr){var n="opera";e.browser=n,t[n]=!0}if(t.safari&&t.android){var a="android";e.browser=a,t[a]=!0}return t.name=e.browser,t.platform=e.platform,t}),App.factory("colors",["APP_COLORS",function(e){return{byName:function(t){return e[t]||"#fff"}}}]),App.service("navSearch",function(){var e="form.navbar-form";return{toggle:function(){var t=$(e);t.toggleClass("open");var r=t.hasClass("open");t.find("input")[r?"focus":"blur"]()},dismiss:function(){$(e).removeClass("open").find('input[type="text"]').blur().val("")}}}),App.provider("RouteHelpers",["APP_REQUIRES",function(e){"use strict";this.basepath=function(e){return"app/views/"+e},this.resolveFor=function(){var t=arguments;return{deps:["$ocLazyLoad","$q",function(r,o){function n(e){return"function"==typeof e?i.then(e):i.then(function(){var t=a(e);return t?r.load(t):$.error("Route resolve: Bad resource name ["+e+"]")})}function a(t){if(e.modules)for(var r in e.modules)if(e.modules[r].name&&e.modules[r].name===t)return e.modules[r];return e.scripts&&e.scripts[t]}for(var i=o.when(1),s=0,l=t.length;l>s;s++)i=n(t[s]);return i}]}},this.$get=function(){}}]),App.service("toggleStateService",["$rootScope",function(e){var t="toggleState",r={hasWord:function(e,t){return new RegExp("(^|\\s)"+t+"(\\s|$)").test(e)},addWord:function(e,t){return this.hasWord(e,t)?void 0:e+(e?" ":"")+t},removeWord:function(e,t){return this.hasWord(e,t)?e.replace(new RegExp("(^|\\s)*"+t+"(\\s|$)*","g"),""):void 0}};return{addState:function(o){var n=angular.fromJson(e.$storage[t]);n=n?r.addWord(n,o):o,e.$storage[t]=angular.toJson(n)},removeState:function(o){var n=e.$storage[t];n&&(n=r.removeWord(n,o),e.$storage[t]=angular.toJson(n))},restoreState:function(r){var o=angular.fromJson(e.$storage[t]);o&&r.addClass(o)}}}]),App.service("Utils",["$window","APP_MEDIAQUERY",function(e,t){"use strict";var r=angular.element("html"),o=angular.element(e),n=angular.element("body");return{support:{transition:function(){var e=function(){var e,t=document.body||document.documentElement,r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(e in r)if(void 0!==t.style[e])return r[e]}();return e&&{end:e}}(),animation:function(){var e=function(){var e,t=document.body||document.documentElement,r={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd oanimationend",animation:"animationend"};for(e in r)if(void 0!==t.style[e])return r[e]}();return e&&{end:e}}(),requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},touch:"ontouchstart"in window&&navigator.userAgent.toLowerCase().match(/mobile|tablet/)||window.DocumentTouch&&document instanceof window.DocumentTouch||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0||!1,mutationobserver:window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null},isInView:function(e,t){var r=$(e);if(!r.is(":visible"))return!1;var n=o.scrollLeft(),a=o.scrollTop(),i=r.offset(),s=i.left,l=i.top;return t=$.extend({topoffset:0,leftoffset:0},t),l+r.height()>=a&&l-t.topoffset<=a+o.height()&&s+r.width()>=n&&s-t.leftoffset<=n+o.width()?!0:!1},langdirection:"rtl"==r.attr("dir")?"right":"left",isTouch:function(){return r.hasClass("touch")},isSidebarCollapsed:function(){return n.hasClass("aside-collapsed")},isSidebarToggled:function(){return n.hasClass("aside-toggled")},isMobile:function(){return o.width()<t.tablet}}}]),App.filter("percentage",["$filter",function(e){return function(t,r){return e("number")(100*t,r||0)+"%"}}]),App.filter("moment",function(){return function(e,t){return moment(e).format(t||"YYYY-MM-DD HH:mm:ss")}}),App.filter("moment_unix",function(){return function(e,t){return moment.unix(e).format(t||"YYYY-MM-DD HH:mm:ss")}}),App.filter("merchant_ability",function(){var e={anybrand:"维修任意品牌",charge:"充电",onsite:"5公里内上门服务",wheel2:"修2轮车",wheel3:"修3轮车"};return function(t){return e[t]}}),App.filter("loginError",function(){var e={"login failed":"登录失败"};return function(t){return e[t]}}),App.filter("mass_filter",["$filter",function(e){return function(e){if(e&&e.region){var t=e.region.province;return t+=e.region.city||"",t+"用户"}return"全部用户"}}]),App.filter("testState",function(){var e={testing:"系统扫描中...",pass:"正常",error:"故障",repairing:"系统修复中...",repaired:"修复",broken:"故障"};return function(t){return e[t]}}).filter("testCountError",function(){return function(e){var t=e.reduce(function(e,t){return"pass"!==t.state&&e++,e},0);return t}}).filter("testRepairedPercent",function(){return function(e){var t=0,r=0;return e.forEach(function(e){"pass"!==e.state&&t++,"repaired"===e.state&&r++}),t?Math.round(100*r/t)+"%":"N/A"}});var myApp=angular.module("myAppName",["angle"]);myApp.run(["$log",function(e){e.log("I'm a line from custom.js")}]),myApp.config(["RouteHelpersProvider",function(e){}]),myApp.controller("oneOfMyOwnController",["$scope",function(e){}]),myApp.directive("oneOfMyOwnDirectives",function(){}),myApp.config(["$stateProvider",function(e){}]);